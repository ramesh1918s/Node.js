https://github.com/daws-81s/expenses-documention/blob/main/mysql.MD

MY_ami_name : devops-practice

- Create a Instance = database_server (3 instances for same ami create ,t3.micro )
- Connection for terminal (ssh ec2-user@52.206.194.87 , yes ,passdw:DevOps321)
- sudo su - 
-----------install Mysql server -------------------

- dnf install mysql-server -y

---------------Start MySQL Service------------------

- systemctl enable mysqld
-  systemctl start mysqld
- systemctl status mysqld

- Next, We need to change the default root password in order to start using the database service. Use password ExpenseApp@1 or any other as per your choice.

- mysql_secure_installation --set-root-pass ExpenseApp@1

---- To check the internet for the server used this command ---------------------

- netstat -lntp

Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1255/sshd: /usr/sbi 
tcp6       0      0 :::22                   :::*                    LISTEN      1255/sshd: /usr/sbi 
tcp6       0      0 :::3306                 :::*                    LISTEN      1905/mysqld         
tcp6       0      0 :::33060  

---------------------To check the prcoss for this server--------------------

- ps -ef | grep mysql 
-  ps -ef | grep mysql

mysql       1905       1  0 11:22 ?        00:00:02 /usr/libexec/mysqld --basedir=/usr
root        1987    1360  0 11:29 pts/0    00:00:00 grep --color=auto mysql

- mysql (to connect the client to Mysql server ) defaultly download the client mysql 
- show database
- mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
4 rows in set (0.01 sec)

mysql> 

mysql> show tables;
ERROR 1046 (3D000): No database selected
mysql> use mysql;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+------------------------------------------------------+
| Tables_in_mysql                                      |
+------------------------------------------------------+
| columns_priv                                         |
| component                                            |
| db                                                   |
| default_roles                                        |
| engine_cost                                          |
| func                                                 |
| general_log                                          |
| global_grants                                        |
| gtid_executed                                        |
| help_category                                        |
| help_keyword                                         |
| help_relation                                        |
| help_topic                                           |
| innodb_index_stats                                   |
| innodb_table_stats                                   |
| password_history                                     |
| plugin                                               |
| procs_priv                                           |
| proxies_priv                                         |
| replication_asynchronous_connection_failover         |
| replication_asynchronous_connection_failover_managed |
| replication_group_configuration_version              |
| replication_group_member_actions                     |
| role_edges                                           |
| server_cost                                          |
| servers                                              |
| slave_master_info                                    |
| slave_relay_log_info                                 |
| slave_worker_info                                    |
| slow_log                                             |
| tables_priv                                          |
| time_zone                                            |
| time_zone_leap_second                                |
| time_zone_name                                       |
| time_zone_transition                                 |
| time_zone_transition_type                            |
| user                                                 |
+------------------------------------------------------+
37 rows in set (0.01 sec)

mysql> select * from user;
+-----------+------------------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------------------+--------------------------+----------------------------+---------------+-------------+-----------------+----------------------+-----------------------+------------------------------------------------------------------------+------------------+-----------------------+-------------------+----------------+------------------+----------------+------------------------+---------------------+--------------------------+-----------------+
| Host      | User             | Select_priv | Insert_priv | Update_priv | Delete_priv | Create_priv | Drop_priv | Reload_priv | Shutdown_priv | Process_priv | File_priv | Grant_priv | References_priv | Index_priv | Alter_priv | Show_db_priv | Super_priv | Create_tmp_table_priv | Lock_tables_priv | Execute_priv | Repl_slave_priv | Repl_client_priv | Create_view_priv | Show_view_priv | Create_routine_priv | Alter_routine_priv | Create_user_priv | Event_priv | Trigger_priv | Create_tablespace_priv | ssl_type | ssl_cipher             | x509_issuer              | x509_subject               | max_questions | max_updates | max_connections | max_user_connections | plugin                | authentication_string                                                  | password_expired | password_last_changed | password_lifetime | account_locked | Create_role_priv | Drop_role_priv | Password_reuse_history | Password_reuse_time | Password_require_current | User_attributes |
+-----------+------------------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------------------+--------------------------+----------------------------+---------------+-------------+-----------------+----------------------+-----------------------+------------------------------------------------------------------------+------------------+-----------------------+-------------------+----------------+------------------+----------------+------------------------+---------------------+--------------------------+-----------------+
| %         | root             | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          | 0x                     | 0x                       | 0x                         |             0 |           0 |               0 |                    0 | caching_sha2_password | $A$005$p:s2<+i6PKvrw ,A/5AYv7yf.rJAFBzjR.rGJrkcJbSfnMe3XbbjXoPWf9C | N                | 2025-01-23 11:23:12   |              NULL | N              | Y                | Y              |                   NULL |                NULL | NULL                     | NULL            |
| localhost | mysql.infoschema | Y           | N           | N           | N           | N           | N         | N           | N             | N            | N         | N          | N               | N          | N          | N            | N          | N                     | N                | N            | N               | N                | N                | N              | N                   | N                  | N                | N          | N            | N                      |          | 0x                     | 0x                       | 0x                         |             0 |           0 |               0 |                    0 | caching_sha2_password | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED | N                | 2025-01-23 11:22:08   |              NULL | Y              | N                | N              |                   NULL |                NULL | NULL                     | NULL            |
| localhost | mysql.session    | N           | N           | N           | N           | N           | N         | N           | Y             | N            | N         | N          | N               | N          | N          | N            | Y          | N                     | N                | N            | N               | N                | N                | N              | N                   | N                  | N                | N          | N            | N                      |          | 0x                     | 0x                       | 0x                         |             0 |           0 |               0 |                    0 | caching_sha2_password | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED | N                | 2025-01-23 11:22:08   |              NULL | Y              | N                | N              |                   NULL |                NULL | NULL                     | NULL            |
| localhost | mysql.sys        | N           | N           | N           | N           | N           | N         | N           | N             | N            | N         | N          | N               | N          | N          | N            | N          | N                     | N                | N            | N               | N                | N                | N              | N                   | N                  | N                | N          | N            | N                      |          | 0x                     | 0x                       | 0x                         |             0 |           0 |               0 |                    0 | caching_sha2_password | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED | N                | 2025-01-23 11:22:08   |              NULL | Y              | N                | N              |                   NULL |                NULL | NULL                     | NULL            |
| localhost | root             | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          | 0x                     | 0x                       | 0x                         |             0 |           0 |               0 |                    0 | caching_sha2_password |                                                                        | N                | 2025-01-23 11:22:08   |              NULL | N              | Y                | Y              |                   NULL |                NULL | NULL                     | NULL            |
+-----------+------------------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------------------+--------------------------+----------------------------+---------------+-------------+-----------------+----------------------+-----------------------+------------------------------------------------------------------------+------------------+-----------------------+-------------------+----------------+------------------+----------------+------------------------+---------------------+--------------------------+-----------------+
5 rows in set (0.00 sec)

- we can story the date from database 


- exit (exit the mysql client)


-----------------------------------------------------To connect the Backend Serevr---------------------------------------------------------------- 

- ssh ec2-user@34.229.76.8
- yes 
- passwd- DevOps321
- connect the server for Backend
- Developer has chosen NodeJs, Check with developer which version of NodeJS is needed. Developer has set a context that it can work with NodeJS >20

Install NodeJS, By default NodeJS 16 is available, We would like to enable 20 version and install this.

You can list modules by using dnf module list

- dnf module disable nodejs -y
- dnf module enable nodejs:20 -y
- dnf install nodejs -y

- dnf module list nodejs
- dnf module disable nodejs:18 -y
- dnf module disable nodejs:22 -y
- dnf install nodejs -y (install the nodejs)
- dnf install nodejs:20 -y 
- useradd expense (add system user or service user)
- mkdir app     (application place the praticular path are the folder)
- curl -o /tmp/backend.zip https://expense-builds.s3.us-east-1.amazonaws.com/expense-backend-v2.zip
- cd /app
- unzip /tmp/backend.zip
- cat package.json
- npm install

- nodejs 
---------------------------
- build file - package.json
- build tool - npm (node package manager)
- files  -*.json
- npm install
- node_modules (all dependencess)

- system service file place the path /etc/systemd/system/ (the file name end with .service )
- vim /etc/systemd/system/backend.service


- [Unit]
Description = Backend Service

[Service]
User=expense
Environment=DB_HOST="<MYSQL-SERVER-IPADDRESS>"
ExecStart=/bin/node /app/index.js
SyslogIdentifier=backend

[Install]
WantedBy=multi-user.target


- --------Load the service.----

- systemctl daemon-reload

- systemctl start backend
- systemctl enable backend


- [ root@ip-192-40-2-192 /app ]# cat schema/backend.sql

create a schema/database for expense project
create a table 

CREATE DATABASE IF NOT EXISTS transactions;
USE transactions;

CREATE TABLE IF NOT EXISTS transactions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    amount INT,
    description VARCHAR(255)
);

CREATE USER IF NOT EXISTS 'expense'@'%' IDENTIFIED BY 'ExpenseApp@1';
GRANT ALL ON transactions.* TO 'expense'@'%';
FLUSH PRIVILEGES;

---------
- dnf install mysql -y (install on applicationserver for mysql client to connect the mysqlserver )
- mysql -h <MYSQL-SERVER-IPADDRESS> -uroot -pExpenseApp@1 < /app/schema/backend.sql
  
- app/ path we can use  ( mysql -h mysql.urukundu.live -uroot -pExpenseApp@1 < schema/backend.sql)
-----
- go to database server
- mysql 
- mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| transactions       |
+--------------------+
5 rows in set (0.01 sec)

mysql> use transactions
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables
    -> q
    -> e
    -> 
    -> 
    -> show tables;
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'q
e


show tables' at line 2
mysql> show tables;
+------------------------+
| Tables_in_transactions |
+------------------------+
| transactions           |
+------------------------+
1 row in set (0.00 sec)

mysql> 

------------(creaye roack for transactions )-------------------
- go back backend server
- mysql -h 192.40.2.13 -uroot -pExpenseApp@1 (connect the mysql )
-mysql 

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| transactions       |
+--------------------+
5 rows in set (0.00 sec)

mysql> 
------------------- (exit)
- systemctl restart backend 
- to check the status for backend 
- systemctl status backend  
---------(active backend)
[ root@ip-192-40-2-192 /app ]# systemctl status backend
● backend.service - Backend Service
     Loaded: loaded (/etc/systemd/system/backend.service; enabled; preset: disabled)
     Active: active (running) since Thu 2025-01-23 13:32:21 UTC; 1min 39s ago
   Main PID: 15291 (node)
      Tasks: 7 (limit: 4015)
     Memory: 24.8M
        CPU: 445ms
     CGroup: /system.slice/backend.service
             └─15291 /bin/node /app/index.js

Jan 23 13:32:21 ip-192-40-2-192.ec2.internal systemd[1]: Started Backend Service.
Jan 23 13:32:21 ip-192-40-2-192.ec2.internal snoopy[15291]: [uid:1002 sid:15291 tty:(none) cwd:/ filename:/bin/node]: /bin/node /app/index.js
Jan 23 13:32:21 ip-192-40-2-192.ec2.internal backend[15291]: { "timestamp" : 1737639141, "msg" : "App Started on Port 8080" }

34.229.76.8 | 192.40.2.192 | t3.micro | null
[ root@ip-192-40-2-192 /app ]# 


------------------
netstat -lntp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1255/sshd: /usr/sbi 
tcp6       0      0 :::8080                 :::*                    LISTEN      15291/node          
tcp6       0      0 :::22                   :::*                    LISTEN      1255/sshd: /usr/sbi 

34.229.76.8 | 192.40.2.192 | t3.micro | null
[ root@ip-192-40-2-192 /app ]# 
==================(to check the application process)
-  ps -ef | grep node
root         716       2  0 11:12 ?        00:00:00 [xfs-inodegc/dm-]
root         816       2  0 11:12 ?        00:00:00 [xfs-inodegc/dm-]
root         820       2  0 11:12 ?        00:00:00 [xfs-inodegc/dm-]
root         856       2  0 11:12 ?        00:00:00 [xfs-inodegc/nvm]
root         878       2  0 11:12 ?        00:00:00 [xfs-inodegc/dm-]
root         881       2  0 11:12 ?        00:00:00 [xfs-inodegc/dm-]
root         898       2  0 11:12 ?        00:00:00 [xfs-inodegc/dm-]
expense    15291       1  0 13:32 ?        00:00:00 /bin/node /app/index.js
root       15313    1390  0 13:36 pts/0    00:00:00 grep --color=auto node

34.229.76.8 | 192.40.2.192 | t3.micro | null
[ root@ip-192-40-2-192 /app ]# 
----------------------(expense    15291       1  0 13:32 ?        00:00:00 /bin/node /app/index.js)--------------------

- to check the internet database server
- ping 192.40.2.13
-  telnet 192.40.2.13 3306
Trying 192.40.2.13...
Connected to 192.40.2.13.
Escape character is '^]'.
J
_caching_sha2_password

-----------------(forntend server create)--------------------
- same instane ami (t3.micro)
- dnf install nginx -y 
- systemctl enable nginx
- systemctl start nginx
- etc (exstra configurations)
- etc/nginx --nginx configurations
- usr/share/nginx/html --we are plced website 
- var/log/nginx -- here placed log of nginx
- 54.234.67.180 (redhot nginx website veiwble)
- rm -rf /usr/share/nginx/html/*  (remove the nginx website)
- cd / (root)
- curl -o /tmp/frontend.zip https://expense-builds.s3.us-east-1.amazonaws.com/expense-frontend-v2.zip
- cd /usr/share/nginx/html (move cd html direct)
- unzip /tmp/frontend.zip (unzip the download code )
- ls -al
total 12
drwxr-xr-x 3 root root  83 Jan 23 14:10 .
drwxr-xr-x 4 root root  33 Jan 23 13:54 ..
-rw-r--r-- 1 root root 611 Feb 25  2024 asset-manifest.json
-rw-r--r-- 1 root root 487 Feb 25  2024 index.html
-rw-r--r-- 1 root root  67 Feb 25  2024 robots.txt
drwxr-xr-x 5 root root  40 Feb 25  2024 static

54.234.67.180 | 192.40.2.12 | t3.micro | null
[ root@ip-192-40-2-12 /usr/share/nginx/html ]# 

-------------------(html port for code)------------------------
- vim /etc/nginx/default.d/expense.conf

- proxy_http_version 1.1;

location /api/ { proxy_pass http://localhost:8080/; }

location /health {
  stub_status on;
  access_log off;
}

-----(how know the backend server )------------

cat /etc/nginx/default.d/expense.conf
proxy_http_version 1.1;

location /api/ { proxy_pass http://192.40.2.192:8080/; }

location /health {
  stub_status on;
  access_log off;
}
-----------------

- systemctl restart nginx

- 54.234.67.180 (seachar for google open website)
- add date 
- 200 travel
- 100 food


--------we can check the date for user in database server---------

* from transactions;
+----+--------+-------------+
| id | amount | description |
+----+--------+-------------+
|  1 |    200 | travel      |
|  2 |    100 | food        |
+----+--------+-------------+
2 rows in set (0.00 sec)

mysql> 


------------------------succesefully completed the project-------------------------------------------------------